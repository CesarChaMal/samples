tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: artemis.ais.topologies.Aisui
  template_version: 2.1.0-SNAPSHOT
  template_author: admin

description: "This archive has been created with alien4cloud."

imports:
  - artemis.ais.containers.udalight:2.1.0-SNAPSHOT
  - tosca-normative-types:1.0.0-ALIEN20
  - artemis.impala.pub:2.1.0-SNAPSHOT
  - artemis.kudu.pub:2.1.0-SNAPSHOT
  - artemis.ais.containers.rest:2.1.0-SNAPSHOT
  - artemis.postgre.pub:2.1.0-SNAPSHOT
  - artemis.redis.pub:2.1.0-SNAPSHOT
  - docker-types:2.1.0-SNAPSHOT

topology_template:
  node_templates:
    DU_UdaMasBgd:
      metadata:
        a4c_edit_x: 365
        a4c_edit_y: 189
      type: org.alien4cloud.extended.container.types.ContainerDeploymentUnit
      capabilities:
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    CR_UdaMasBgd:
      type: org.alien4cloud.extended.container.types.ContainerRuntime
      requirements:
        - hostedOnDuUdaMasBgdHost:
            type_requirement: host
            node: DU_UdaMasBgd
            capability: tosca.capabilities.Container.Docker
            relationship: tosca.relationships.HostedOn
    UdaMasbgd:
      type: artemis.ais.containers.rest.nodes.UdaMasbgd
      properties:
        docker_run_cmd: "/opt/bigdata/bin/start.sh"
        docker_run_args: "-Xmx4096M\",\"-DapplicationName=masbgd"
        config_settings: 
          - input_prefix: "CFG_"
            mount_path: "/config"
            config_path: configFiles
        cpu_share: 1.0
        mem_share: "128 MB"
      requirements:
        - hostedOnContainerRuntimeCrUdaMasBgdHost:
            type_requirement: host
            node: CR_UdaMasBgd
            capability: org.alien4cloud.extended.container.capabilities.ApplicationHost
            relationship: org.alien4cloud.extended.container.relationships.HostedOnContainerRuntime
        - connectsToImpalaServiceImpala_endpoint:
            type_requirement: metastore
            node: ImpalaService
            capability: artemis.impala.pub.capabilities.Impala
            relationship: tosca.relationships.ConnectsTo
        - connectsToKuduServiceKudu_endpoint:
            type_requirement: fresh_data
            node: KuduService
            capability: artemis.kudu.pub.capabilities.Kudu
            relationship: tosca.relationships.ConnectsTo
        - connectsToRedisServiceRedis_endpoint:
            type_requirement: last_data
            node: RedisService
            capability: artemis.redis.pub.capabilities.Redis
            relationship: tosca.relationships.ConnectsTo
      capabilities:
        web_service:
          properties:
            port: 8080
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    ImpalaService:
      metadata:
        a4c_edit_x: 916
        a4c_edit_y: 144
      type: artemis.impala.pub.nodes.ImpalaService
      capabilities:
        impala_endpoint:
          properties:
            port: 15001
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    KuduService:
      metadata:
        a4c_edit_x: 913
        a4c_edit_y: 227
      type: artemis.kudu.pub.nodes.KuduService
      capabilities:
        kudu_endpoint:
          properties:
            port: 8050
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    RedisService:
      metadata:
        a4c_edit_x: 911
        a4c_edit_y: 312
      type: artemis.redis.pub.nodes.RedisService
      capabilities:
        redis_endpoint:
          properties:
            port: 6379
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
    DU_UdaLight:
      metadata:
        a4c_edit_x: 15
        a4c_edit_y: 197
      type: org.alien4cloud.extended.container.types.ContainerDeploymentUnit
      capabilities:
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    CR_UdaLight:
      type: org.alien4cloud.extended.container.types.ContainerRuntime
      requirements:
        - hostedOnDuUdaLightHost:
            type_requirement: host
            node: DU_UdaLight
            capability: tosca.capabilities.Container.Docker
            relationship: tosca.relationships.HostedOn
    UdaLight:
      type: artemis.ais.containers.nodes.UdaLight
      properties:
        docker_run_cmd: "/tmp/run-appli.sh"
        docker_run_args: "-Xmx512M"
        config_settings: 
          - input_prefix: "CFG_"
            mount_path: "/config"
            config_path: configFiles
        cpu_share: 1.0
        mem_share: "128 MB"
      requirements:
        - connectsToPostgreServicePostgre_endpoint:
            type_requirement: postgre_udalight
            node: PostgreService
            capability: artemis.postgre.pub.capabilities.PostgreEndpoint
            relationship: tosca.relationships.ConnectsTo
        - hostedOnContainerRuntimeCrUdaLightHost:
            type_requirement: host
            node: CR_UdaLight
            capability: org.alien4cloud.extended.container.capabilities.ApplicationHost
            relationship: org.alien4cloud.extended.container.relationships.HostedOnContainerRuntime
        - connectsToUdaMasbgdWeb_service:
            type_requirement: uda_masbgd
            node: UdaMasbgd
            capability: artemis.ais.containers.rest.capabilities.UdaMasbgdEndpoint
            relationship: tosca.relationships.ConnectsTo
      capabilities:
        web_service:
          properties:
            port: 8081
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    PostgreService:
      metadata:
        a4c_edit_x: 368
        a4c_edit_y: 59
      type: artemis.postgre.pub.nodes.PostgreService
      capabilities:
        postgre_endpoint:
          properties:
            port: 5432
            protocol: tcp
            secure: false
            network_name: PRIVATE
            initiator: source
