
metadata:
  template_name: artemis.ais.containers.rest
  template_version: 2.1.0-SNAPSHOT
  template_author: alien4cloud

imports:
  - tosca-normative-types:1.0.0-ALIEN20
  - docker-types:2.1.0-SNAPSHOT
  - artemis.redis.pub:2.1.0-SNAPSHOT
  - artemis.kudu.pub:2.1.0-SNAPSHOT
  - artemis.impala.pub:2.1.0-SNAPSHOT

repositories:
  docker:
    url: https://hub.docker.com/
    type: http

node_types:

  artemis.ais.containers.rest.nodes.UdaMasbgd:
    derived_from: tosca.nodes.Container.Application.ConfigurableDockerContainer
    description: Compposant de MASBGD
    requirements:
      - metastore:
          capability: artemis.impala.pub.capabilities.Impala
          relationship: tosca.relationships.ConnectsTo
          occurrences: [1, 1]
      - fresh_data:
          capability: artemis.kudu.pub.capabilities.Kudu
          relationship: tosca.relationships.ConnectsTo
          occurrences: [1, 1]
      - last_data:
          capability: artemis.redis.pub.capabilities.Redis
          relationship: tosca.relationships.ConnectsTo
          occurrences: [1, 1]          


    capabilities:
      http:
        type: tosca.capabilities.Endpoint
        properties:
          port: 8080
      https:
        type: tosca.capabilities.Endpoint
        properties:
          port: 443         
    interfaces:
      Standard:
        create:
          inputs:
            CFG_REDIS_HOST : {get_attribute: [TARGET,last_data,redis_endpoint,ip_address]}
            CFG_REDIS_PORT : {get_attribute: [TARGET,last_data,redis_endpoint,port]}
            CFG_KUDU_HOST : {get_attribute: [TARGET,fresh_data,kudu_endpoint,ip_address]}
            CFG_KUDU_PORT : {get_attribute: [TARGET,fresh_data,kudu_endpoint,port]}  
            CFG_IMPALA_HOST : {get_attribute: [TARGET,metastore,impala_endpoint,ip_address]}
            CFG_IMPALA_PORT : {get_attribute: [TARGET,metastore,impala_endpoint,port]}  
            
          implementation:
            file: registry.artemis.public/fbouy/ais/uda-repository-bigdata:2.36.00-ARTEMIS-SNAPSHOT
            repository: docker
            type: tosca.artifacts.Deployment.Image.Container.Docker

    properties:
      docker_run_cmd:
        type: string
        default: "/opt/bigdata/bin/start.sh"
      docker_run_args:
        type: string
        default: "-Xmx4096M\",\"-DapplicationName=masbgd"    
      config_settings:
        type: list
        required: false
        entry_schema:
          type: org.alien4cloud.extended.container.datatypes.ConfigSetting
        default:
        - mount_path: /config
          input_prefix: CFG_
          config_path: configFiles        
        
    capabilities:
      web_service:
        type: artemis.ais.containers.rest.capabilities.UdaMasbgdEndpoint
 

capability_types:

  artemis.ais.containers.rest.capabilities.UdaMasbgdEndpoint:
    derived_from: tosca.capabilities.Endpoint
    properties:
      port:
        type: integer
        default: 8080

 